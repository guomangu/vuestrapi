(function(){"use strict";var e={6350:function(e,t,o){var s=o(4220),i=o(9812),n=o(5893);const r=(0,i._)("br",null,null,-1),a={key:0},l={key:1,style:{"text-decoration":"underline",color:"#3fba83"}},c=(0,i._)("br",null,null,-1);function u(e,t,o,u,d,h){const p=(0,i.up)("router-link"),f=(0,i.up)("router-view");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("nav",null,[(0,i._)("form",{class:"d-flex",onSubmit:t[3]||(t[3]=(...e)=>h.submitForm&&h.submitForm(...e))},[(0,i.wy)((0,i._)("input",{placeholder:"VILLE",onKeyup:t[0]||(t[0]=e=>h.barre()),"onUpdate:modelValue":t[1]||(t[1]=e=>d.input=e),class:"form-control me-2",style:{"border-color":"#40b983"},type:"search","aria-label":"Search"},null,544),[[s.nr,d.input]]),(0,i._)("button",{onClick:t[2]||(t[2]=e=>h.sea()),class:"btn btn-outline-success",type:"submit",style:{"white-space":"nowrap","border-color":"#40b983",color:"#35495e"}},(0,n.zw)(d.place),1)],32),r,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(this.u,(e=>((0,i.wg)(),(0,i.j4)(p,{key:e,to:e[0]},{default:(0,i.w5)((()=>[d.preplace!=e[0]?((0,i.wg)(),(0,i.iD)("span",a," /"+(0,n.zw)(e[0]),1)):((0,i.wg)(),(0,i.iD)("span",l," /"+(0,n.zw)(e[0]),1))])),_:2},1032,["to"])))),128)),c]),(0,i.Wm)(f)],64)}o(7658);var d={data(){return{u:{},input:this.input,place:"Resultats",preplace:""}},mounted(){this.final()},methods:{sea(){"Resultats"!=this.place?(this.$router.push("/"+this.place),this.place="Resultats",this.input=""):this.place="Resultats"},submitForm(e){e.preventDefault()},barre(){if(this.input.length<3)return void(this.place="Resultats");let e="https://api-adresse.data.gouv.fr/search/?q="+this.input+"&limit=1";fetch(e,{method:"GET"}).then((e=>e.json())).then((e=>{console.log(e.features[0].properties.city),this.place=e.features[0].properties.city}))},final(){this.preplace=window.location.href.split("/")[3]}},watch:{"$store.state.url":{deep:!0,handler(e){e.forEach(((e,t)=>{this.u[t]=[],this.u[t][0]=decodeURI(e)})),console.log(this.u),this.final()}}}},h=o(8998);const p=(0,h.Z)(d,[["render",u]]);var f=p,m=o(8525);(0,m.z)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var g=o(644);const b={class:"home"};function v(e,t,o,s,n,r){const a=(0,i.up)("HelloWorld");return(0,i.wg)(),(0,i.iD)("div",b,[(0,i.Wm)(a)])}const w=e=>((0,i.dD)("data-v-033c73b1"),e=e(),(0,i.Cn)(),e),y={class:"hello",style:{color:"#35495e"}},_=w((()=>(0,i._)("br",null,null,-1))),k=w((()=>(0,i._)("div",{class:"spinner-border text-success",role:"status",id:"ani",style:{display:"none"}},null,-1))),j={key:0,class:"card",style:{"max-width":"400px",display:"inline-block","background-color":"#40b9834d",margin:"1em"}},x=["onClick"],S={class:"card-title"},N={class:"card-text"},C={class:"card-text"},I={class:"text-muted"},O=["id"],E={class:"card text-center"},T={class:"card-body"},D=w((()=>(0,i._)("i",{class:"fas fa-plus-square"},null,-1))),z=["v-if"],F={class:"card-header"},R={class:"card-body"},U={class:"card-text"},H={class:"card text-center"},P={class:"card-body"},W=["onClick"],Z=w((()=>(0,i._)("br",null,null,-1)));function q(e,t,o,r,a,l){return(0,i.wg)(),(0,i.iD)("div",y,[(0,i._)("h1",null,[(0,i._)("a",null,"#"+(0,n.zw)(a.commune.nom),1)]),_,k,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(a.prise,((e,o)=>((0,i.wg)(),(0,i.iD)("div",{key:e},["undefined"!==e.lib_taf?((0,i.wg)(),(0,i.iD)("div",j,[(0,i._)("div",{class:"card-body",onClick:e=>l.f(o)},[(0,i._)("h5",S,(0,n.zw)(e.lib_taf),1),(0,i._)("p",N,(0,n.zw)(e.nom_complet),1),(0,i._)("p",C,[(0,i._)("small",I,(0,n.zw)(e.matching_etablissements[0].adresse),1)])],8,x),(0,i._)("div",{id:o,style:{display:"none",margin:"1em"}},[(0,i._)("div",E,[(0,i._)("div",T,[(0,i.Uk)(" Salle "+(0,n.zw)(e.salleNameId)+" de "+(0,n.zw)(a.commune.nom)+" ",1),D])]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.info,(t=>((0,i.wg)(),(0,i.iD)("div",{"v-if":e.info,key:t,class:"card text-center",style:{margin:"5px"}},[(0,i._)("div",F,(0,n.zw)(t.usernom),1),(0,i._)("div",R,[(0,i._)("p",U,(0,n.zw)(t.text),1)])],8,z)))),128)),(0,i._)("div",H,[(0,i._)("div",P,[(0,i._)("form",{onSubmit:t[2]||(t[2]=(...e)=>l.submitForm&&l.submitForm(...e))},[(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>a.rep.user=e),class:"form-control",placeholder:"pseudo"},null,512),[[s.nr,a.rep.user]]),(0,i.wy)((0,i._)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>a.rep.rep=e),class:"form-control",placeholder:"message"},null,512),[[s.nr,a.rep.rep]]),(0,i._)("input",{style:{"margin-top":"10px"},class:"btn btn-dark",type:"submit",onClick:e=>l.poster(a.rep.user,a.rep.rep,o)},null,8,W)],32)])])],8,O)])):(0,i.kq)("",!0)])))),128)),Z])}var A=o(9526),V={name:"HelloWorld",data(){return{commune:{},long:"",lat:"",prise:{},fora:{},rep:{},gu:"https://api.alternativeadapt.com"}},watch:{$route:{deep:!0,handler(){this.gogo()}}},async mounted(){this.gogo()},methods:{submitForm(e){e.preventDefault()},gogo(){if(this.sw(),console.log("launch on the sworl"),console.log(this.prise),console.log(A.Z.get()),this.getSave()){console.log("on recupe du cookie");let e=window.location.href,t=e.split("/");this.commune.nom=decodeURI(t[3])}else console.log("on recupe du fetch"),this.load(!0),this.start();console.log(this.prise)},sw(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.active.postMessage({type:"updateCache",url:window.location.href})}))},start(){let e=window.location.href,t=e.split("/");if(""!==t[3]){let e="https://api-adresse.data.gouv.fr/search/?q="+decodeURI(t[3]);this.commune.nom=decodeURI(t[3]),fetch(e,{method:"GET"}).then((e=>e.json())).then((e=>{this.long=e.features[0].geometry.coordinates[0],this.lat=e.features[0].geometry.coordinates[1];let t="https://geo.api.gouv.fr/communes?lon="+this.long+"&lat="+this.lat;this.bonjour(t)}))}else navigator.geolocation.getCurrentPosition((e=>{let t="https://geo.api.gouv.fr/communes?lon="+e.coords.longitude+"&lat="+e.coords.latitude;this.long=e.coords.longitude,this.lat=e.coords.latitude,this.bonjour(t)}))},async bonjour(e){console.log("!!!!!"),console.log(e),await fetch(e,{}).then((e=>e.json())).then((e=>{this.commune=e[0];let t=window.location.href,o=t.split("/");o[3]||(window.location.href=this.commune.nom),this.bonjour2boite()}))},async bonjour2boite(){console.log(this.commune),await fetch("https://recherche-entreprises.api.gouv.fr/search?code_postal="+this.commune.codesPostaux+"&est_organisme_formation=true&section_activite_principale=J&etat_administratif=A&limite_matching_etablissements=1&page=1&per_page=25",{method:"GET"}).then((e=>e.json())).then((e=>{this.prise=e.results,this.bonjour3trad()}))},async bonjour3trad(){await this.prise.forEach(((e,t,o)=>{fetch("https://api.insee.fr/metadonnees/V1/codes/nafr2/sousClasse/"+e.matching_etablissements[0].activite_principale,{method:"GET",headers:{Accept:"application/json",Authorization:"Bearer 2c32c9b2-2159-3dab-b761-b11314415124"}}).then((e=>e.json())).then((s=>{e.lib_taf="","undefined"===typeof s.intitule|"undefined"===s.intitule?o.splice(t,1):e.lib_taf=s.intitule})).catch((()=>{e.lib_taf="undefined",o=o.slice(0,t+1).concat(o.slice(t+1))})).then((()=>{t==o.length-1&&(this.load(!1),this.getForum())}))}))},async getForum(){let e=this.gu+"/api/salles?populate=forums.forumuser";try{this.prise.forEach((t=>{"undefined"!==t.lib_taf&&(e+="&filters[salleName][$eq]="+String(t.lib_taf).replace(/\s/g,"")+String(this.commune.nom).replace(/\s/g,""))}))}catch(t){for(let o=0;o<10;o++)try{"undefined"!==this.prise[o].lib_taf&&(e+="&filters[salleName][$eq]="+String(this.prise[o].lib_taf).replace(/\s/g,"")+String(this.commune.nom).replace(/\s/g,""))}catch(t){}}console.log(e),await fetch(e,{method:"GET",headers:{Accept:"application/json"}}).then((e=>e.json())).then((e=>{for(let t=0;t<10;t++)if(this.prise[t])for(let o=0;o<e.data.length;o++)if(console.log(this.prise[t].salleName),this.prise[t].salleName&&null!=this.prise[t].salleName||(this.prise[t].salleName=String(this.prise[t].lib_taf).replace(/\s/g,"")+String(this.commune.nom).replace(/\s/g,"")),this.prise[t].salleName===String(e.data[o].attributes.salleName).replace(/\s/g,"")){this.prise[t].salleName=e.data[o].attributes.salleName,this.prise[t].salleNameId=e.data[o].id;for(let s=0;s<e.data[o].attributes.forums.data.length;s++)this.prise[t].info||(this.prise[t].info=[]),this.prise[t].info[s]||(this.prise[t].info[s]={}),this.prise[t].info[s].text=e.data[o].attributes.forums.data[s].attributes.text,this.prise[t].info[s].textId=e.data[o].attributes.forums.data[s].id,this.prise[t].info[s].usernom=e.data[o].attributes.forums.data[s].attributes.forumuser.data.attributes.usernom,this.prise[t].info[s].usernomId=e.data[o].attributes.forums.data[s].attributes.forumuser.data.id}console.log(this.prise)})).then((()=>{this.save()}))},async poster(e,t,o){if(t.length<2|e.length<2)return void console.log("ecrit plus boi");let s,i,n;this.prise[o].lib_taf&&(i=String(this.prise[o].lib_taf).replace(/\s/g,"")+String(this.commune.nom).replace(/\s/g,""),await fetch(this.gu+"/api/salles/"+this.prise[o].salleNameId,{method:"GET"}).then((e=>e.json())).then((e=>{console.log(e),s=e.data.id})).catch((()=>{fetch(this.gu+"/api/salles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:{salleName:i}})}).then((e=>e.json())).then((e=>{console.log(e),s=e.data.id}))})));let r,a=!0;this.prise[o].info&&this.prise[o].info.forEach((t=>{t.usernom==e&&(n=t.usernomId,a=!1)})),a?(r={data:{usernom:e}},await fetch(this.gu+"/api/forumusers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).then((e=>{r=e})).catch((e=>{console.error(e)}))):r={data:{id:n}};let l={data:{text:t,forumuser:r.data.id,salle:s}};await fetch(this.gu+"/api/forums",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)}).then((e=>{const t=e.json();console.log(t),this.getForum(),this.rep.rep=""})).catch((e=>{console.error(e)}))},save(){let e=[],t=this.prise;for(let s=0;s<t.length;s++)if(e[s]=[],e[s][0]=String(t[s].lib_taf),e[s][1]=t[s].nom_complet,e[s][2]=t[s].matching_etablissements[0].adresse,e[s][3]=t[s].salleName,e[s][4]=t[s].salleNameId,t[s].info)for(let o=0;o<t[s].info.length;o++)e[s][5]||(e[s][5]=[]),e[s][5][o]=[],e[s][5][o][0]=t[s].info[o].text,e[s][5][o][1]=t[s].info[o].textId,e[s][5][o][2]=t[s].info[o].usernom,e[s][5][o][3]=t[s].info[o].usernomId;console.log(e);let o=JSON.stringify(e);this.writeCookie(this.commune.nom,o)},getSave(){console.log(window.location.href);let e=window.location.href,t=e.split("/"),o=this.readCookie(decodeURI(t[3]));if(console.log(o),void 0!==o&&"[]"!==o){let e=JSON.parse(o);for(let t=0;t<e.length;t++)if(this.prise[t]={},this.prise[t].lib_taf=String(e[t][0]),this.prise[t].nom_complet=e[t][1],this.prise[t].matching_etablissements=[],this.prise[t].matching_etablissements[0]={},this.prise[t].matching_etablissements[0].adresse=e[t][2],this.prise[t].salleName=e[t][3],this.prise[t].salleNameId=e[t][4],console.log(e[t][5]),e[t][5])for(let o=0;o<e[t][5].length;o++)this.prise[t].info||(this.prise[t].info=[]),this.prise[t].info[o]={},this.prise[t].info[o].text=e[t][5][o][0],this.prise[t].info[o].textId=e[t][5][o][1],this.prise[t].info[o].usernom=e[t][5][o][2],this.prise[t].info[o].usernomId=e[t][5][o][3];return console.log(this.prise),!0}return!1},writeCookie(e,t){e=decodeURI(e),A.Z.remove(e),A.Z.set(e,t),this.majCoo()},readCookie(e){return this.majCoo(),A.Z.get(e)},majCoo(){let e=A.Z.get();e=Object.keys(e).map((function(t){return[t,e[t]]}));let t=[],o=0;e.forEach((e=>{t[o]=e[0],o++})),this.$store.state.url=t},f(e){let t=document.getElementById(String(e));"none"==t.style.display?t.style.display=" inline-block":t.style.display="none"},load(e){let t=document.getElementById("ani");t.style.display=e?"inline-block":"none"}}};const G=(0,h.Z)(V,[["render",q],["__scopeId","data-v-033c73b1"]]);var J=G,$={name:"HomeView",components:{HelloWorld:J}};const B=(0,h.Z)($,[["render",v]]);var K=B;const Y=[{path:"/",name:"home",component:K},{name:"working",path:"/:Ville",component:K}],L=(0,g.p7)({history:(0,g.PO)(),routes:Y});var M=L,Q=o(2357),X=(0,Q.MT)({state:{url:{}},getters:{},mutations:{},actions:{},modules:{}});window.addEventListener("load",(function(){navigator.serviceWorker.register("/service-worker.js")})),(0,s.ri)(f).use(X).use(M).mount("#app")}},t={};function o(s){var i=t[s];if(void 0!==i)return i.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,o),n.exports}o.m=e,function(){var e=[];o.O=function(t,s,i,n){if(!s){var r=1/0;for(u=0;u<e.length;u++){s=e[u][0],i=e[u][1],n=e[u][2];for(var a=!0,l=0;l<s.length;l++)(!1&n||r>=n)&&Object.keys(o.O).every((function(e){return o.O[e](s[l])}))?s.splice(l--,1):(a=!1,n<r&&(r=n));if(a){e.splice(u--,1);var c=i();void 0!==c&&(t=c)}}return t}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[s,i,n]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={143:0};o.O.j=function(t){return 0===e[t]};var t=function(t,s){var i,n,r=s[0],a=s[1],l=s[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(i in a)o.o(a,i)&&(o.m[i]=a[i]);if(l)var u=l(o)}for(t&&t(s);c<r.length;c++)n=r[c],o.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return o.O(u)},s=self["webpackChunkapp"]=self["webpackChunkapp"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=o.O(void 0,[998],(function(){return o(6350)}));s=o.O(s)})();
//# sourceMappingURL=app.3c0af57e.js.map